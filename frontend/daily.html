<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Vista diaria</title>
  <link rel="stylesheet" href="css/activity-card.css">
  <link rel="stylesheet" href="css/daily.css">
</head>
<body>
  <main>
    <h1>Agenda diaria</h1>
    <div class="day-nav">
      <button id="prevDay" aria-label="Día anterior">◀</button>
      <select id="daySelect" aria-label="Seleccionar día"></select>
      <button id="nextDay" aria-label="Día siguiente">▶</button>
    </div>
    <div id="dayContainer" class="activities-list"></div>
  </main>

  <script src="js/cargarDatos.js"></script>
  <script src="js/gestionarFechas.js"></script>
  <script src="js/daily.js"></script>
  <script>
    let actividades = [];
    let dias = [];
    const select = document.getElementById('daySelect');
    let indice = 0;

    async function cargarDatos() {
      const mesActual = obtenerMesActual();
      try {
        actividades = await fetchData(mesActual);
        dias = [...new Set(actividades.map(a => a.Dia))];

        select.innerHTML = '';
        dias.forEach(d => {
          const opt = document.createElement('option');
          opt.value = d;
          opt.textContent = d;
          select.appendChild(opt);
        });

        indice = 0;
        actualizar();
      } catch (err) {
        console.error('Error cargando datos:', err);
      }
    }

    function actualizar() {
      const dia = dias[indice];
      pintarVistaDiaria(actividades, dia);
      select.value = dia;
    }

    select.addEventListener('change', () => {
      indice = dias.indexOf(select.value);
      actualizar();
    });

    document.getElementById('prevDay').addEventListener('click', () => {
      indice = (indice - 1 + dias.length) % dias.length;
      actualizar();
    });

    document.getElementById('nextDay').addEventListener('click', () => {
      indice = (indice + 1) % dias.length;
      actualizar();
    });

    cargarDatos();
  </script>
</body>
</html>
